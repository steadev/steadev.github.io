<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Ionic 인앱결제 (in app purchase 2)" /><meta name="author" content="steadev" /><meta property="og:locale" content="en" /><meta name="description" content="Ionic으로 인앱결제를 해보면서 native에 비해 자료도 적고 가려운 곳을 긁어주는 정보들이 별로 없었습니다." /><meta property="og:description" content="Ionic으로 인앱결제를 해보면서 native에 비해 자료도 적고 가려운 곳을 긁어주는 정보들이 별로 없었습니다." /><link rel="canonical" href="https://steadev.github.io/posts/ionic-inapp-purchase/" /><meta property="og:url" content="https://steadev.github.io/posts/ionic-inapp-purchase/" /><meta property="og:site_name" content="개발 공책" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-04-26T13:43:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Ionic 인앱결제 (in app purchase 2)" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@steadev" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"steadev"},"dateModified":"2022-06-15T21:46:05+08:00","datePublished":"2020-04-26T13:43:00+08:00","description":"Ionic으로 인앱결제를 해보면서 native에 비해 자료도 적고 가려운 곳을 긁어주는 정보들이 별로 없었습니다.","headline":"Ionic 인앱결제 (in app purchase 2)","mainEntityOfPage":{"@type":"WebPage","@id":"https://steadev.github.io/posts/ionic-inapp-purchase/"},"url":"https://steadev.github.io/posts/ionic-inapp-purchase/"}</script><title>Ionic 인앱결제 (in app purchase 2) | 개발 공책</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="개발 공책"><meta name="application-name" content="개발 공책"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://raw.githubusercontent.com/cotes2020/chirpy-images/main/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">개발 공책</a></div><div class="site-subtitle font-italic">배운점을 기록하고 공유하는 공간</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/steadev" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['audwn0326','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Ionic 인앱결제 (in app purchase 2)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Ionic 인앱결제 (in app purchase 2)</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1587879780" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Apr 26, 2020 </em> </span> <span> Updated <em class="" data-ts="1655300765" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 15, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> 이명주 </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2932 words"> <em>16 min</em> read</span></div></div></div><div class="post-content"><p>Ionic으로 인앱결제를 해보면서 native에 비해 자료도 적고 가려운 곳을 긁어주는 정보들이 별로 없었습니다.</p><p>그래서 이것이 제가 했던 것을 기록하는 의미도 있지만 누군가에게는 도움이 됬으면 합니다.</p><ol><li>Ionic<ul><li>Code<li>billing.fovea.cc</ul><li>안드로이드<ul><li>상품 등록<li>sandbox</ul><li>IOS<ul><li>상품 등록<li>sandbox<li>계약</ul></ol><p>들어가기에 앞서, 처음에 저는 코드상으로 상품을 등록하고 결제하는 과정을 전부 할 수 있을 줄 알았습니다.</p><p>DB만 바꿔주면 상품명과 가격 등의 정보도 바로바로 바꿀 수 있을 줄 알았습니다…ㅠㅠ</p><p>그래서 관련 부분을 찾느라 삽질을 했어서, 혹시나 저와 같은 분이 계시다면! 각 플랫폼에 상품을 미리 등록해놓은 다음 그 정보를 바탕으로 결제하는 것이니 참고하시기 바랍니다.</p><h2 id="1-ionic"><span class="mr-2">1. Ionic</span><a href="#1-ionic" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="code"><span class="mr-2"><strong>[Code]</strong></span><a href="#code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Ionic에는 ‘In App Purchase’와 ‘In App Purchase 2’ 이렇게 두 종류의 플러긴을 제공합니다. ‘2’ 버전을 사용하는 이유는 billing.fovea.cc를 활용하기 위해서 입니다. 결제 검증을 알아서 해주는 서비스로, backend에서 할 일을 줄여줍니다. 물론, 굳이 저기를 쓰지 않아도 상관은 없습니다. </p><p>먼저 상품을 등록해 줍니다. </p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">register</span><span class="p">({</span>
    <span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">my_consumable1</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">CONSUMABLE</span>
<span class="p">});</span>
<span class="p">...</span>
<span class="kd">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">my_consumable1</span><span class="dl">"</span><span class="p">);</span>
</pre></table></code></div></div><p>처음엔 등록한다는게 각 스토어에 등록한다는 얘긴줄 알고 이렇게 하면 되겠다 했지만… 그렇게 쉬울리 없죠</p><p>이때 id는 스토어에 등록한 product id와 동일해야 합니다.</p><p>그리고 type은 게임 아이템과 같이 소모품이라면 CONSUMABLE</p><p>비정기구독의 경우는(apple만 해당) NON_PAID_SUBSCRIPTION</p><p>정기구독의 경우는 PAID_SUBSCRIPTION</p><p>이렇게 해주시면 됩니다. 하지만 개발 테스트시에는 그냥 전부 consumable로 통일하는게 낫다고 생각합니다. </p><p>그리고 아래의 get은 해당 id의 상품 IAPProduct 객체를 가져오는 것인데, 저는 개인적으로 쓸일이 없었습니다.</p><p>다음으로는 각 상품의 상태에 따라서 할 일들을 미리 정해놓는 부분입니다. </p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">validator</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">https://billing.fovea.cc/</span><span class="dl">"</span><span class="p">;</span>
<span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="dl">"</span><span class="s2">my stuff</span><span class="dl">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">approved</span><span class="p">((</span><span class="nx">p</span><span class="p">:</span> <span class="nx">IAPProduct</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">verify</span><span class="p">())</span>
    <span class="p">.</span><span class="nx">verified</span><span class="p">((</span><span class="nx">p</span><span class="p">:</span> <span class="nx">IAPProduct</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">finish</span><span class="p">());</span>
</pre></table></code></div></div><p>ionic 문서에 다양한 케이스들이 있지만 그 부분들은 문서에서 충분히 알 수 있고,</p><p>이 부분이 제일 저를 속썩였던 부분이라 한번 짚고 넘어가도록 하겠습니다. </p><p>먼저, 저런 문법은 사용이 불가합니다. ts버전이 다른걸까도 싶었지만 plugin 코드를 봐도 approved는 void를 return하기 때문에 성립할 수가 없는 문법입니다. 그냥 표기상의 편의를 위해 저렇게 작성해 놓은 듯 합니다. 그래서 아래처럼 나눠서 사용하면 문제 없습니다.</p><p>추가적으로, 검증에 실패했을 경우에는 unverified를 사용하면 됩니다.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="dl">'</span><span class="s1">my_product_id</span><span class="dl">'</span><span class="p">).</span><span class="nx">approved</span><span class="p">(</span><span class="nx">p</span><span class="o">=&gt;</span><span class="nx">p</span><span class="p">.</span><span class="nx">verify</span><span class="p">());</span>
<span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="dl">'</span><span class="s1">my_product_id</span><span class="dl">'</span><span class="p">).</span><span class="nx">verified</span><span class="p">(</span><span class="nx">p</span><span class="o">=&gt;</span><span class="nx">p</span><span class="p">.</span><span class="nx">finish</span><span class="p">());</span>
<span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="dl">'</span><span class="s1">my_product_id</span><span class="dl">'</span><span class="p">).</span><span class="nx">unverified</span><span class="p">(</span><span class="nx">p</span><span class="o">=&gt;</span><span class="nx">p</span><span class="p">);</span>
</pre></table></code></div></div><p>approved는 결제가 완료됬을 때 입니다. 인앱결제 프로세스가 끝나면 이 부분이 실행되고 </p><p>validator로 지정해 놓은 url을 통해 검증을 합니다.</p><p>저의 경우는 billing.fovea.cc에서 이를 알아서 처리하고 검증 결과에 따라 verified 혹은 unverified로 오게 됩니다. </p><p>그런데 여기에서 제일 큰 의문이 들었습니다. approved 되었을 땐 이미 금액도 빠져나가고 결제가 된 상태인데 그 후에 검증하면 무슨 소용이 있을까 싶었습니다. 이를 바탕으로 billing fovea측에 문의 해본 결과 이렇게 답변이 왔습니다. </p><blockquote><p>If payment is approved and verification failed, the payment is not acknowledged. The user will get refund (or not get charged) automatically by Google. You don’t have to do anything.</p></blockquote><p>결제는 승인 됬지만, acknowledged는 안됬고 그렇기에 자동으로 며칠 안으로 해당 유저는 환불 받게 될 것이라고 합니다. 여기에서 중요한 것이 p.finish() 입니다. 이를 해주면 acknowledged 상태가 되는 것이니 아무데서나 finish 함수를 사용하면 안되겠습니다. </p><p>마지막으로 store.when의 세팅이 끝나면 아래와 같이 refresh를 해주고 원하는 곳에서 order 해주면 인앱결제가 완료됩니다.</p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1">// Refresh the status of in-app products</span>
<span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">refresh</span><span class="p">();</span>

<span class="p">...</span>

<span class="c1">// To make a purchase</span>
<span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">order</span><span class="p">(</span><span class="dl">"</span><span class="s2">my_product_id</span><span class="dl">"</span><span class="p">);</span>
</pre></table></code></div></div><p>여기에서 <strong>주의해야 할 사항</strong>이 하나 있습니다. </p><p><strong>store.when의 세팅은 맨 처음 시작할때, 즉, app.component.ts에서 platform.ready() 직후에 해주는 것이 좋습니다.</strong> </p><p>처음에는 결제 부분이 있는 페이지에 코드를 작성했었습니다. </p><p>그런데 그 페이지를 나갔다 들어올 때마다 세팅들이 중첩되기 시작했습니다. 예를들면, </p><div class="language-typescript highlighter-rouge"><div class="code-header"> <span data-label-text="TypeScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">this</span><span class="p">.</span><span class="nx">store</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="dl">'</span><span class="s1">my_product_id</span><span class="dl">'</span><span class="p">).</span><span class="nx">cancelled</span><span class="p">(</span><span class="nx">p</span><span class="o">=&gt;</span><span class="p">{</span> <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">결제가 취소되었습니다</span><span class="dl">'</span><span class="p">)</span> <span class="p">});</span>
</pre></table></code></div></div><p>이러한 코드가 있을 때, 결제 도중에 취소해버리면 alert 창이 여러번(해당 페이지에 드나든 횟수만큼…) 뜨게 됩니다. 더욱 중요한 것은 approved도 여러번, 검증도 여러번 하게되어 DB에 중복 데이터들이 쌓이게 됬습니다. 이부분까지 주의해 주신다면 보다 수월하게 개발을 진행할 수 있습니다.. 이것 때문에 괜한 삽질을 너무 많이 했었던 기억이…</p><h3 id="billingfoveacc"><span class="mr-2"><strong>[billing.fovea.cc]</strong></span><a href="#billingfoveacc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>일단, 이 서비스는 유료입니다.</p><p>한달 100건의 거래까지는 무료지만 5000건은 10달러, 10만건은 50달러 입니다.(작성일 기준). </p><p>이 서비스의 문서에 각 플랫폼 별로 세팅하는 부분을 자세하게 설명해주고 있어서 그대로 따라하기만 하면 금방 세팅이 끝납니다. 결제가 완료되면 그 로그들도 직접 확인할 수도 있습니다. </p><p>세팅이 완료되면 여기서 제공해주는 Validator URL을 위의 this.store.validator에 적용하면 되겠습니다. </p><p>그런데 여기서 제일 삽질했던 부분은 iOS Subscription Status URL을 appstore에 작성하는 부분이었습니다. </p><p>사실 제가 하는 개발에서는 구독 상품은 판매하지 않아서 필요 없었는데 혹시 몰라 미리 입력해 놓으려다가 시간을 많이 잡아먹었던 부분입니다. </p><p>아래 IOS 파트에서도 언급하겠지만 유료상품 계약이 되야 구독 상품을 생성할 수 있고 구독 상품을 생성해야 iOS Subscription Status URL을 작성할 수 있습니다.</p><h2 id="2-안드로이드"><span class="mr-2"><strong>2. 안드로이드</strong></span><a href="#2-안드로이드" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="상품등록"><span class="mr-2"><strong>[상품등록]</strong></span><a href="#상품등록" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>상품등록 관련은 정보가 많아서 따로 기록하진 않겠습니다. 하지만, 주의(?) 해야 할 부분 하나만 짚고 넘어가겠습니다. </p><p><img data-src="https://steadev.github.io/assets/images/ionic/ionic-inapp-purchase-1.png" data-proofer-ignore></p><p>위 사진을 보면, 분명 가격을 KRW 14900이라고 입력했지만, 아래 빨간 부분을 보면 지들 멋대로 1000원 단위로 끊어버립니다. 만원 이하는 900원이 제대로 되는 것 같은데, 그 이상은 안되는 듯 싶습니다.(가물가물..) </p><p>그치만 큰 문제는 아니라 그냥 저 부분에도 14900원으로 입력해주시면 끝납니다.</p><h3 id="sandbox"><span class="mr-2"><strong>[sandbox]</strong></span><a href="#sandbox" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>안드로이드의 테스트 계정 등록은 간단합니다.  ‘,’로 구분하여 이메일을 입력하면 됩니다. </p><p>등록 후, 해당 play store 계정으로 구매버튼을 누르면 테스트 계정이라고 뜨며,</p><p>결제 성공, 취소, 조금 있다 성공, 조금 있다 취소 이렇게 4가지 종류로 바로 테스트 해볼 수 있도록 제공됩니다.(갓구글…)</p><p><img data-src="https://steadev.github.io/assets/images/ionic/ionic-inapp-purchase-2.png" data-proofer-ignore></p><h2 id="3-ios"><span class="mr-2"><strong>3. IOS</strong></span><a href="#3-ios" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="상품등록-1"><span class="mr-2"><strong>[상품등록]</strong></span><a href="#상품등록-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>IOS 상품 등록도 그리 어렵진 않지만 애플이 항상 그렇듯 귀찮은 부분이 있습니다. </p><p><img data-src="https://steadev.github.io/assets/images/ionic/ionic-inapp-purchase-3.png" data-proofer-ignore></p><p>우선 위 사진의 앱 내 구입 옆에 + 버튼으로 상품을 추가해봅니다. 그러면 아래의 그림처럼 나옵니다.</p><p><img data-src="https://steadev.github.io/assets/images/ionic/ionic-inapp-purchase-4.png" data-proofer-ignore></p><p>하지만.. 사실 위 그림처럼 나오려면 조건이 필요합니다.. 아무것도 안한했다면 빨간 박스의 자동 갱신 구독이 없습니다. </p><p>위에 billing.fovea.cc에서도 설명했듯이 아래 [계약] 부분을 완성해야 위 캡처처럼 보여, 구독 상품을 생성할 수 있고 구독 상품을 생성해야 iOS Subscription Status URL(아래 캡처의 구독 상태 URL)을 작성할 수 있습니다.</p><p><img data-src="https://steadev.github.io/assets/images/ionic/ionic-inapp-purchase-5.png" data-proofer-ignore></p><p>마지막으로, 상품 내용을 작성하면 되는데, <strong>심사정보-&gt;스크린샷</strong> 부분을 넣어주셔야 될 겁니다.(안 넣어도 된다는 말이 있지만 혹시나 해서…)</p><p>만약 저 부분을 비워놓으면 진행상태가 메타데이터 등록하라고 뜹니다. </p><p>스크린샷 까지 넣고 나면, 진행 상태가 제출 준비됐다고 표시되고 여기까지만 진행하면 이제 끝입니다. </p><p>제 캡처처럼 “승인됨”으로 뜨려면 앱 제출해서 심사까지 거쳐야 되는 것이고 제출 준비 상태까지만 되도 테스트하는데는 문제 없습니다.</p><h3 id="sandbox-1"><span class="mr-2"><strong>[sandbox]</strong></span><a href="#sandbox-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>사용자 및 액세스에 들어가면 왼쪽 제일 아래에 Sandbox가 있습니다. </p><p>이곳에서 테스터 등록하면 되는데, </p><p>저기에 들어갈 이메일은 <strong>App store에 등록된 계정이 아니어야 됩니다!</strong></p><p>그리고 <strong>실존하는 메일이 아니어도 됩니다.</strong> </p><p>그냥 아무렇게나 메일 작성하면 끝!! </p><p>그리고 후에 테스트 할때는 <strong>기존 로그인 되있는 계정은 로그아웃 하신 상태</strong>에서 테스트 하시면 됩니다.</p><p>그러면 결제할 때 이 이메일과 비밀번호를 작성하면 정상적으로 Sandbox 결제가 진행됩니다.</p><p><img data-src="https://steadev.github.io/assets/images/ionic/ionic-inapp-purchase-6.png" data-proofer-ignore></p><h3 id="계약"><span class="mr-2"><strong>[계약]</strong></span><a href="#계약" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><img data-src="https://steadev.github.io/assets/images/ionic/ionic-inapp-purchase-7.png" data-proofer-ignore></p><p>빨간 유료 앱 부분이 보이시나요?! 이 부분을 몰라서 엄청 이상한 곳에서 삽질을 오랫동안 했었습니다.. ㅠㅠ</p><p>유료 앱에는 주소, 세금 관련(…?) 등 정확한 내용은 기억이 안나지만 여러 정보들 입력하면 애플에서 또 심사를 합니다.. 그놈의 심사.. </p><p>쨋든, <strong>유료앱 부분이 활성 상태가 아니라면</strong>, 암만 Ionic in app purchase를 고치고 고쳐도 product id를 알 수 없다는 피드백만 올 뿐입니다. 다른 걸 다 했더라도 이 부분이 안되면.. !!</p><p>이미 IOS 결제 개발 하셨던 분들이라면 당연히 알고 계실테지만, 처음 하시는 분들은 이게 조금이나마 도움이 됬으면 합니다. </p><p>길었지만, 여기까지 따라 오셨다면 큰 문제 없이 구현이 될 것이라 생각합니다. </p><p>질문이나 지적하실 부분이 있으시면 댓글 부탁드립니다 :)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ionic/'>Ionic</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ionic/" class="post-tag no-text-decoration" >Ionic</a> <a href="/tags/inapppurchase/" class="post-tag no-text-decoration" >InAppPurchase</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Ionic+%EC%9D%B8%EC%95%B1%EA%B2%B0%EC%A0%9C+%28in+app+purchase+2%29+-+%EA%B0%9C%EB%B0%9C+%EA%B3%B5%EC%B1%85&url=https%3A%2F%2Fsteadev.github.io%2Fposts%2Fionic-inapp-purchase%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Ionic+%EC%9D%B8%EC%95%B1%EA%B2%B0%EC%A0%9C+%28in+app+purchase+2%29+-+%EA%B0%9C%EB%B0%9C+%EA%B3%B5%EC%B1%85&u=https%3A%2F%2Fsteadev.github.io%2Fposts%2Fionic-inapp-purchase%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsteadev.github.io%2Fposts%2Fionic-inapp-purchase%2F&text=Ionic+%EC%9D%B8%EC%95%B1%EA%B2%B0%EC%A0%9C+%28in+app+purchase+2%29+-+%EA%B0%9C%EB%B0%9C+%EA%B3%B5%EC%B1%85" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/aws-lambda-edge/">Lambda@Edge를 통한 Dynamic OG Tags, SEO</a><li><a href="/posts/html-useful-tags/">유용한 html tags</a><li><a href="/posts/ionic-appflow/">[Ionic] DevOps Solution - AppFlow</a><li><a href="/posts/js-async-defer/">script 속성 async / defer</a><li><a href="/posts/js-rxjs-overview/">[Javascript] RxJS - Overview 번역</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/baekjoon/">Baekjoon</a> <a class="post-tag" href="/tags/refactoring/">refactoring</a> <a class="post-tag" href="/tags/kakao/">Kakao</a> <a class="post-tag" href="/tags/rxjs/">rxjs</a> <a class="post-tag" href="/tags/angular/">angular</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/array/">array</a> <a class="post-tag" href="/tags/html/">html</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ionic-appflow/"><div class="card-body"> <em class="small" data-ts="1625381460" data-df="ll" > Jul 4, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Ionic] DevOps Solution - AppFlow</h3><div class="text-muted small"><p> React Native에 Code Push가 있다면, Ionic에는 AppFlow가 있습니다!! 만약 cordova를 사용중이라면 Code Push를 활용하면 되지만, capacitor라면 AppFlow를 활용하면 됩니다! AppFlow 유료 버전을 사용하면 Native 빌드와 배포까지 할 수 있지만,  이 글에서는 무료로 활용할 수 있는 유용...</p></div></div></a></div><div class="card"> <a href="/posts/rn-word-break-keep-all/"><div class="card-body"> <em class="small" data-ts="1665652200" data-df="ll" > Oct 13, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[React Native] word-break</h3><div class="text-muted small"><p> word-break와 같은 부분이 적용이 안되는 이슈! RN에는 CSS와 조금 다르게 스타일이 적용되는 부분들이 있는데요..! 그 중에서 word-break: keep-all을 적용하고 싶은데 안되는 이슈가… 왜 이것도 지원 안해주지? 하는 의문이 들었습니다. 아직 RN 버전이 0.대라 부족한 부분이 많은 것 같긴 합니다. 버전 1.대까지 간다면...</p></div></div></a></div><div class="card"> <a href="/posts/css-scss/"><div class="card-body"> <em class="small" data-ts="1660487460" data-df="ll" > Aug 14, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CSS Preprocessor - SCSS</h3><div class="text-muted small"><p> SASS vs SCSS sass 이후에 scss가 나왔고, css와 거의 같은 문법으로 sass의 기능을 지원합니다. sass 에는 ; 와 {} 가 없습니다. sass vs scss → = vs @mixin , + vs @include SASS 1 2 3 4 5 6 7 8 9 10 11 =image($size) w...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/algorithm-bj-2206/" class="btn btn-outline-primary" prompt="Older"><p>[백준] 2206번 벽 부수고 이동하기</p></a> <a href="/posts/algorithm-bj-12865/" class="btn btn-outline-primary" prompt="Newer"><p>[백준] 12865번 평범한 배낭</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/steadev">이명주</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/baekjoon/">Baekjoon</a> <a class="post-tag" href="/tags/refactoring/">refactoring</a> <a class="post-tag" href="/tags/kakao/">Kakao</a> <a class="post-tag" href="/tags/rxjs/">rxjs</a> <a class="post-tag" href="/tags/angular/">angular</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/array/">array</a> <a class="post-tag" href="/tags/html/">html</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
